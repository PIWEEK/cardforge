(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&d(c)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();let B="";function g(e){parent.postMessage(e,"*")}function A(){window.addEventListener("message",e=>{console.log("[main] received:"),console.log(e),e.data.type=="ERROR_DECK_CREATE_PAGE_NOT_EMPTY"?k(!0):e.data.type=="CARDS_DATA"?R(e.data.data):e.data.type=="CARD_FIELDS"?(B=e.data.data.assetsUrl,m=e.data.data.fields,z()):e.data.type=="IMAGE_CREATED"?_(e.data.data.num,e.data.data.name,e.data.data.id,e.data.data.imageId):e.data.type=="PAGE_EMPTY"&&(e.data.data?v("create"):v("cards"))})}const C=document.querySelectorAll(".tab-selector"),w=document.querySelectorAll(".tab");function v(e){var t,a;for(const d of C)d.classList.remove("current");(t=document.getElementById("ts-"+e))==null||t.classList.add("current");for(const d of w)d.classList.add("hidden");(a=document.getElementById("tab-"+e))==null||a.classList.remove("hidden"),L(!1)}function M(){for(const e of C)e.addEventListener("click",()=>{v(e.getAttribute("data-tab"))})}const b=[["Dixit (80 x 120 mm)",945,1417],["Tarot (70 x 120 mm)",827,1417],["French tarot (61 x 112 mm)",720,1323],["Wonder (65 x 100 mm)",768,1181],["Volcano (70 x 110 mm)",827,1299],["Euro (59 x 92 mm)",697,1086],["Asia (57,5 x 89 mm)",679,1051],["Standard (Poker) (63,5 x 88 mm)",750,1039],["USA (56 x 87 mm)",661,1027],["Square L (80x80 mm)",945,945],["Desert (50 x 75 mm)",590,886],["Square S (70 x 70 mm)",827,827],["Mini EURO (45 x 68 mm)",531,803],["Mini Asia (43 x 65 mm)",508,768],["Mini USA (41 x 63 mm)",484,744]];function O(e){var n,r,c;e.preventDefault();let t=(n=document.getElementById("create-deck-name"))==null?void 0:n.value,a=(r=document.getElementById("create-deck-size"))==null?void 0:r.value,d=(c=document.getElementById("create-deck-orientation"))==null?void 0:c.value;g({type:"create-deck",name:t,size:a,orientation:d,data:null})}function k(e){var t,a,d,n;e?((t=document.getElementById("box-create-error"))==null||t.classList.remove("hidden"),(a=document.getElementById("box-create"))==null||a.classList.add("hidden")):((d=document.getElementById("box-create-error"))==null||d.classList.add("hidden"),(n=document.getElementById("box-create"))==null||n.classList.remove("hidden"))}function D(){let e=document.getElementById("create-deck-size");e.innerHTML="";let t;for(let a=0;a<b.length;a++)t=document.createElement("option"),t.value=""+a,t.innerText=b[a][0].toString(),e==null||e.appendChild(t);e.value="7"}function P(){var e,t;(e=document.getElementById("create-deck-frm"))==null||e.addEventListener("submit",O),(t=document.getElementById("box-create-error-close"))==null||t.addEventListener("click",()=>{k(!1)}),D()}const u=document.getElementById("card-list");let m=[],i=[];function y(){g({type:"save-cards-data",data:JSON.stringify(i)})}function _(e,t,a,d){i[e-1][t]=d+"|"+a,y()}function R(e){e&&(i=JSON.parse(e),x())}function T(e,t){let a=document.createElement("div");a.classList.add("card-entry"),a.id="card-entry-"+e;let d=document.createElement("div");d.classList.add("card-actions");let n=document.createElement("div");n.classList.add("card-action-copy"),n.addEventListener("click",()=>{N(e)}),d.appendChild(n);let r=document.createElement("div");r.classList.add("card-action-delete"),r.addEventListener("click",()=>{q(e)}),d.appendChild(r);let c=document.createElement("div");c.classList.add("card-num"),c.innerText=String(e).padStart(2,"0"),a.appendChild(c);for(let s=0;s<m.length;s++)if(m[s].type=="text"){let o=document.createElement("div");o.classList.add("card-text");let l=document.createElement("input");t.hasOwnProperty(m[s].name)&&(l.value=t[m[s].name]),l.addEventListener("blur",()=>{F(e,m[s].name,l.value)}),o.appendChild(l),a.appendChild(o)}else{let o=document.createElement("div");o.classList.add("card-image");let l=document.createElement("img"),f=document.createElement("input");if(f.type="file",f.accept="image/*",o.appendChild(f),t.hasOwnProperty(m[s].name)){let E=t[m[s].name].split("|")[1];l.src=B+E,o.classList.add("card-image-full")}else l.src="images/add_image.png";o.appendChild(l),l.addEventListener("click",()=>{f.click()}),f.addEventListener("change",E=>{H(e,m[s].name,l,E)}),a.appendChild(o)}return a.appendChild(d),a}function U(){let e={};i.push(e);let t=T(i.length,e);u==null||u.appendChild(t),y(),u.scrollTop=u==null?void 0:u.scrollHeight}function q(e){i.splice(e-1,1),y(),x()}function N(e){let t=structuredClone(i[e-1]);i.splice(e-1,0,t),y(),x()}function F(e,t,a){i[e-1][t]=a,y()}async function H(e,t,a,d){var r;const n=d.target;if((r=n==null?void 0:n.files)!=null&&r.length){const c=n==null?void 0:n.files[0];if(c){const s=await c.arrayBuffer(),o=new Uint8Array(s),l=c.type,f=URL.createObjectURL(new Blob([o],{type:l}));a.src=f,a.parentNode instanceof HTMLElement&&a.parentNode.classList.add("card-image-full"),g({type:"create-image-data",data:{data:o,mimeType:l,num:e,name:t}}),n.value=""}}}function z(){const e=document.getElementById("cards-header"),t=document.getElementById("cards-header-actions");document.querySelectorAll(".card-header").forEach(a=>a.remove());for(let a=0;a<m.length;a++){let d=m[a],n=document.createElement("div");n.classList.add("card-header"),d.type=="image"?n.classList.add("card-image"):n.classList.add("card-text"),n.innerText=d.name.substring(1),e==null||e.insertBefore(n,t)}g({type:"load-cards-data",data:""})}function x(){document.querySelectorAll(".card-entry").forEach(e=>e.remove());for(let e=0;e<i.length;e++){let t=T(e+1,i[e]);u==null||u.appendChild(t)}}function L(e){var t,a,d,n;e?((t=document.getElementById("cards-container"))==null||t.classList.add("hidden"),(a=document.getElementById("box-forge"))==null||a.classList.remove("hidden"),document.getElementById("forge-type").value="standard",document.getElementById("forge-cut-marks").value="true",S(),I()):((d=document.getElementById("cards-container"))==null||d.classList.remove("hidden"),(n=document.getElementById("box-forge"))==null||n.classList.add("hidden"))}function j(){let e=document.getElementById("forge-cut-marks").value,t=document.getElementById("forge-type").value;g({type:"forge-cards",data:{cardsData:i,type:t,cutMarks:e}})}function S(){const e=document.getElementById("forge-explain-type"),t=document.getElementById("forge-type").value,a=document.getElementById("forge-cut-marks");t=="standard"?(e.innerText="It will generate a frame for each card, and an extra frame for the back.",a.disabled=!1):t=="printplay"?(e.innerText="A4 pages with the cards. Cards with the front and the back joined, to cut them together and fold them by the joint.",a.disabled=!1):(e.innerHTML="It will generate a frame with a <a href='https://kb.tabletopsimulator.com/custom-content/custom-deck/' target='_blank'>card set for Tabletop Simulator</a>.",a.value="false",a.disabled=!0),I()}function I(){let e=document.getElementById("forge-explain-marks");document.getElementById("forge-cut-marks").value=="true"?e.innerText="Cut marks will be printed to indicate how to cut the cards.":e.innerText="Cut marks wont't be printed."}function G(){var e,t,a,d,n,r;g({type:"load-card-fields",data:""}),(e=document.getElementById("add-card"))==null||e.addEventListener("click",()=>{U()}),(t=document.getElementById("forge-cards"))==null||t.addEventListener("click",()=>{L(!0)}),(a=document.getElementById("box-forge-cancel"))==null||a.addEventListener("click",()=>{L(!1)}),(d=document.getElementById("box-forge-ok"))==null||d.addEventListener("click",()=>{j()}),(n=document.getElementById("forge-type"))==null||n.addEventListener("change",()=>{S()}),(r=document.getElementById("forge-cut-marks"))==null||r.addEventListener("change",()=>{I()})}let p=0,J=document.querySelectorAll(".help-text");function h(e){var t;p=(p+e+6)%6;for(const a of J)a.classList.add("hidden");(t=document.getElementById("help-text-"+p))==null||t.classList.remove("hidden"),document.getElementById("help-num").innerText=p+1+"/6"}function K(){var e,t;p=0,h(0),(e=document.getElementById("box-help-prev"))==null||e.addEventListener("click",()=>{h(-1)}),(t=document.getElementById("box-help-next"))==null||t.addEventListener("click",()=>{h(1)})}window.onload=e=>{A(),M(),P(),G(),K(),g({type:"is-page-empty",data:""})};
