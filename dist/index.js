(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function d(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=d(a);fetch(a.href,r)}})();let x="";function g(e){parent.postMessage(e,"*")}function S(){window.addEventListener("message",e=>{console.log("[main] received:"),console.log(e),e.data.type=="ERROR_DECK_CREATE_PAGE_NOT_EMPTY"?b(!0):e.data.type=="CARDS_DATA"?P(e.data.data):e.data.type=="CARD_FIELDS"?(x=e.data.data.assetsUrl,m=e.data.data.fields,N()):e.data.type=="IMAGE_CREATED"?D(e.data.data.num,e.data.data.name,e.data.data.id,e.data.data.imageId):e.data.type=="PAGE_EMPTY"&&(e.data.data?E("create"):E("cards"))})}const B=document.querySelectorAll(".tab-selector"),T=document.querySelectorAll(".tab");function E(e){var t,d;for(const n of B)n.classList.remove("current");(t=document.getElementById("ts-"+e))==null||t.classList.add("current");for(const n of T)n.classList.add("hidden");(d=document.getElementById("tab-"+e))==null||d.classList.remove("hidden"),h(!1)}function A(){for(const e of B)e.addEventListener("click",()=>{E(e.dataset.tab)})}const L=[["Dixit (80 x 120 mm)",945,1417],["Tarot (70 x 120 mm)",827,1417],["French tarot (61 x 112 mm)",720,1323],["Wonder (65 x 100 mm)",768,1181],["Volcano (70 x 110 mm)",827,1299],["Euro (59 x 92 mm)",697,1086],["Asia (57,5 x 89 mm)",679,1051],["Standard (Poker) (63,5 x 88 mm)",750,1039],["USA (56 x 87 mm)",661,1027],["Square L (80x80 mm)",945,945],["Desert (50 x 75 mm)",590,886],["Square S (70 x 70 mm)",827,827],["Mini EURO (45 x 68 mm)",531,803],["Mini Asia (43 x 65 mm)",508,768],["Mini USA (41 x 63 mm)",484,744]];function w(e){var a,r,c;e.preventDefault();let t=(a=document.getElementById("create-deck-name"))==null?void 0:a.value,d=(r=document.getElementById("create-deck-size"))==null?void 0:r.value,n=(c=document.getElementById("create-deck-orientation"))==null?void 0:c.value;g({type:"create-deck",name:t,size:d,orientation:n,data:null})}function b(e){var t,d,n,a;e?((t=document.getElementById("box-create-error"))==null||t.classList.remove("hidden"),(d=document.getElementById("box-create"))==null||d.classList.add("hidden")):((n=document.getElementById("box-create-error"))==null||n.classList.add("hidden"),(a=document.getElementById("box-create"))==null||a.classList.remove("hidden"))}function M(){let e=document.getElementById("create-deck-size");e.innerHTML="";let t;for(let d=0;d<L.length;d++)t=document.createElement("option"),t.value=""+d,t.innerText=L[d][0],e==null||e.appendChild(t);e.value=7}function O(){var e,t;(e=document.getElementById("create-deck-frm"))==null||e.addEventListener("submit",w),(t=document.getElementById("box-create-error-close"))==null||t.addEventListener("click",()=>{b(!1)}),M()}const u=document.getElementById("card-list");let m=[],i=[];function p(){g({type:"save-cards-data",data:JSON.stringify(i)})}function D(e,t,d,n){i[e-1][t]=n+"|"+d,p()}function P(e){e&&(i=JSON.parse(e),v())}function C(e,t){let d=document.createElement("div");d.classList.add("card-entry"),d.id="card-entry-"+e;let n=document.createElement("div");n.classList.add("card-actions");let a=document.createElement("div");a.classList.add("card-action-copy"),a.addEventListener("click",()=>{U(e)}),n.appendChild(a);let r=document.createElement("div");r.classList.add("card-action-delete"),r.addEventListener("click",()=>{R(e)}),n.appendChild(r);let c=document.createElement("div");c.classList.add("card-num"),c.innerText=String(e).padStart(2,"0"),d.appendChild(c);for(let l=0;l<m.length;l++)if(m[l].type=="text"){let s=document.createElement("div");s.classList.add("card-text");let o=document.createElement("input");t.hasOwnProperty(m[l].name)&&(o.value=t[m[l].name]),o.addEventListener("blur",()=>{q(e,m[l].name,o.value)}),s.appendChild(o),d.appendChild(s)}else{let s=document.createElement("div");s.classList.add("card-image");let o=document.createElement("img"),f=document.createElement("input");if(f.type="file",f.accept="image/*",s.appendChild(f),t.hasOwnProperty(m[l].name)){let y=t[m[l].name].split("|")[1];o.src=x+y}else o.src="images/add_image.png";s.appendChild(o),o.addEventListener("click",()=>{f.click()}),f.addEventListener("change",y=>{F(e,m[l].name,o,y)}),d.appendChild(s)}return d.appendChild(n),d}function _(){let e={};i.push(e);let t=C(i.length,e);u==null||u.appendChild(t),p(),u.scrollTop=u==null?void 0:u.scrollHeight}function R(e){i.splice(e-1,1),p(),v()}function U(e){let t=structuredClone(i[e-1]);i.splice(e-1,0,t),p(),v()}function q(e,t,d){i[e-1][t]=d,p()}async function F(e,t,d,n){var r;const a=n.target;if((r=a==null?void 0:a.files)!=null&&r.length){const c=a==null?void 0:a.files[0];if(c){const l=await c.arrayBuffer(),s=new Uint8Array(l),o=c.type,f=URL.createObjectURL(new Blob([s],{type:o}));d.src=f,g({type:"create-image-data",data:{data:s,mimeType:o,num:e,name:t}}),a.value=""}}}function N(){const e=document.getElementById("cards-header"),t=document.getElementById("cards-header-actions");document.querySelectorAll(".card-header").forEach(d=>d.remove());for(let d=0;d<m.length;d++){let n=m[d],a=document.createElement("div");a.classList.add("card-header"),n.type=="image"?a.classList.add("card-image"):a.classList.add("card-text"),a.innerText=n.name.substring(1),e==null||e.insertBefore(a,t)}g({type:"load-cards-data",data:""})}function v(){document.querySelectorAll(".card-entry").forEach(e=>e.remove());for(let e=0;e<i.length;e++){let t=C(e+1,i[e]);u==null||u.appendChild(t)}}function h(e){var t,d,n,a;e?((t=document.getElementById("cards-container"))==null||t.classList.add("hidden"),(d=document.getElementById("box-forge"))==null||d.classList.remove("hidden"),document.getElementById("forge-type").value="standard",document.getElementById("forge-cut-marks").value="true",k(),I()):((n=document.getElementById("cards-container"))==null||n.classList.remove("hidden"),(a=document.getElementById("box-forge"))==null||a.classList.add("hidden"))}function z(){let e=document.getElementById("forge-cut-marks").value,t=document.getElementById("forge-type").value;g({type:"forje-cards",data:{cardsData:i,type:t,cutMarks:e}})}function k(){let e=document.getElementById("forge-explain-type"),t=document.getElementById("forge-type").value;t=="standard"?(e.innerText="It will generate a frame for each card, and an extra frame for the back.",document.getElementById("forge-cut-marks").disabled=!1):t=="printplay"?(e.innerText="A4 pages with the cards. Cards with the front and the back joined, to cut them together and fold them by the joint.",document.getElementById("forge-cut-marks").disabled=!1):(e.innerHTML="It will generate a frame with a <a href='https://kb.tabletopsimulator.com/custom-content/custom-deck/' target='_blank'>card set for Tabletop Simulator</a>.",document.getElementById("forge-cut-marks").value="false",document.getElementById("forge-cut-marks").disabled=!0),I()}function I(){let e=document.getElementById("forge-explain-marks");document.getElementById("forge-cut-marks").value=="true"?e.innerText="Cut marks will be printed to indicate how to cut the cards.":e.innerText="Cut marks wont't be printed."}function j(){var e,t,d,n,a,r;g({type:"load-card-fields",data:""}),(e=document.getElementById("add-card"))==null||e.addEventListener("click",()=>{_()}),(t=document.getElementById("forge-cards"))==null||t.addEventListener("click",()=>{h(!0)}),(d=document.getElementById("box-forge-cancel"))==null||d.addEventListener("click",()=>{h(!1)}),(n=document.getElementById("box-forge-ok"))==null||n.addEventListener("click",()=>{z()}),(a=document.getElementById("forge-type"))==null||a.addEventListener("change",()=>{k()}),(r=document.getElementById("forge-cut-marks"))==null||r.addEventListener("change",()=>{I()})}window.onload=e=>{S(),A(),O(),j(),g({type:"is-page-empty",data:""})};
