(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function d(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?c.credentials="include":t.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(t){if(t.ep)return;t.ep=!0;const c=d(t);fetch(t.href,c)}})();let h="";function p(e){parent.postMessage(e,"*")}function I(){window.addEventListener("message",e=>{console.log("received:"),console.log(e),e.data.type=="ERROR_DECK_CREATE_PAGE_NOT_EMPTY"?L(!0):e.data.type=="CARDS_DATA"?w(e.data.data):e.data.type=="CARD_FIELDS"?(h=e.data.data.assetsUrl,m=e.data.data.fields,P()):e.data.type=="IMAGE_CREATED"&&T(e.data.data.num,e.data.data.name,e.data.data.id)})}const v=document.querySelectorAll(".tab-selector"),B=document.querySelectorAll(".tab");function E(e){var a,d;for(const n of v)n.classList.remove("current");(a=document.getElementById("ts-"+e))==null||a.classList.add("current");for(const n of B)n.classList.add("hidden");(d=document.getElementById("tab-"+e))==null||d.classList.remove("hidden")}function A(){for(const e of v)e.addEventListener("click",()=>{E(e.dataset.tab)});E("cards")}function S(e){var t,c,r;e.preventDefault();let a=(t=document.getElementById("create-deck-name"))==null?void 0:t.value,d=(c=document.getElementById("create-deck-size"))==null?void 0:c.value,n=(r=document.getElementById("create-deck-orientation"))==null?void 0:r.value;p({type:"create-deck",name:a,size:d,orientation:n,data:null})}function L(e){var a,d,n,t;e?((a=document.getElementById("box-create-error"))==null||a.classList.remove("hidden"),(d=document.getElementById("box-create"))==null||d.classList.add("hidden")):((n=document.getElementById("box-create-error"))==null||n.classList.add("hidden"),(t=document.getElementById("box-create"))==null||t.classList.remove("hidden"))}function O(){var e,a;(e=document.getElementById("create-deck-frm"))==null||e.addEventListener("submit",S),(a=document.getElementById("box-create-error-close"))==null||a.addEventListener("click",()=>{L(!1)})}const u=document.getElementById("card-list");let m=[],o=[];function y(){p({type:"save-cards-data",data:JSON.stringify(o)})}function T(e,a,d){o[e-1][a]=d,y()}function w(e){e&&(o=JSON.parse(e),g())}function C(e,a){let d=document.createElement("div");d.classList.add("card-entry"),d.id="card-entry-"+e;let n=document.createElement("div");n.classList.add("card-actions");let t=document.createElement("div");t.classList.add("card-action-copy"),t.addEventListener("click",()=>{k(e)}),n.appendChild(t);let c=document.createElement("div");c.classList.add("card-action-delete"),c.addEventListener("click",()=>{D(e)}),n.appendChild(c);let r=document.createElement("div");r.classList.add("card-num"),r.innerText=String(e).padStart(2,"0"),d.appendChild(r);for(let s=0;s<m.length;s++)if(m[s].type=="text"){let i=document.createElement("div");i.classList.add("card-text");let l=document.createElement("input");a.hasOwnProperty(m[s].name)&&(l.value=a[m[s].name]),l.addEventListener("blur",()=>{R(e,m[s].name,l.value)}),i.appendChild(l),d.appendChild(i)}else{let i=document.createElement("div");i.classList.add("card-image");let l=document.createElement("img"),f=document.createElement("input");f.type="file",f.accept="image/*",i.appendChild(f),a.hasOwnProperty(m[s].name)?l.src=h+a[m[s].name]:l.src="images/add_image.png",i.appendChild(l),l.addEventListener("click",()=>{f.click()}),f.addEventListener("change",b=>{_(e,m[s].name,l,b)}),d.appendChild(i)}return d.appendChild(n),d}function x(){let e={};console.log(o),o.push(e);let a=C(o.length,e);u==null||u.appendChild(a),y(),u.scrollTop=u==null?void 0:u.scrollHeight}function D(e){o.splice(e-1,1),g()}function k(e){let a=structuredClone(o[e-1]);o.splice(e-1,0,a),g()}function R(e,a,d){o[e-1][a]=d,y()}async function _(e,a,d,n){var c;const t=n.target;if((c=t==null?void 0:t.files)!=null&&c.length){const r=t==null?void 0:t.files[0];if(r){const s=await r.arrayBuffer(),i=new Uint8Array(s),l=r.type,f=URL.createObjectURL(new Blob([i],{type:l}));d.src=f,p({type:"create-image-data",data:{data:i,mimeType:l,num:e,name:a}}),t.value=""}}}function P(){const e=document.getElementById("cards-header"),a=document.getElementById("cards-header-actions");console.log("cardHeader",e),console.log("cardsHeaderActions",a),document.querySelectorAll(".card-header").forEach(d=>d.remove());for(let d=0;d<m.length;d++){let n=m[d];console.log(n);let t=document.createElement("div");t.classList.add("card-header"),n.type=="image"?t.classList.add("card-image"):t.classList.add("card-text"),t.innerText=n.name,e==null||e.insertBefore(t,a)}p({type:"load-cards-data",data:""})}function g(){document.querySelectorAll(".card-entry").forEach(e=>e.remove());for(let e=0;e<o.length;e++){let a=C(e+1,o[e]);u==null||u.appendChild(a)}}function M(){var e;p({type:"load-card-fields",data:""}),(e=document.getElementById("add-card"))==null||e.addEventListener("click",()=>{x()})}window.onload=e=>{I(),A(),O(),M(),console.log("page is fully loaded")};
