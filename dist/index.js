(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function d(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?c.credentials="include":t.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(t){if(t.ep)return;t.ep=!0;const c=d(t);fetch(t.href,c)}})();let L="";function p(e){parent.postMessage(e,"*")}function I(){window.addEventListener("message",e=>{console.log("received:"),console.log(e),e.data.type=="ERROR_DECK_CREATE_PAGE_NOT_EMPTY"?C(!0):e.data.type=="CARDS_DATA"?k(e.data.data):e.data.type=="CARD_FIELDS"?(L=e.data.data.assetsUrl,m=e.data.data.fields,P()):e.data.type=="IMAGE_CREATED"&&T(e.data.data.num,e.data.data.name,e.data.data.id,e.data.data.imageId)})}const v=document.querySelectorAll(".tab-selector"),B=document.querySelectorAll(".tab");function h(e){var a,d;for(const n of v)n.classList.remove("current");(a=document.getElementById("ts-"+e))==null||a.classList.add("current");for(const n of B)n.classList.add("hidden");(d=document.getElementById("tab-"+e))==null||d.classList.remove("hidden")}function A(){for(const e of v)e.addEventListener("click",()=>{h(e.dataset.tab)});h("create")}function S(e){var t,c,r;e.preventDefault();let a=(t=document.getElementById("create-deck-name"))==null?void 0:t.value,d=(c=document.getElementById("create-deck-size"))==null?void 0:c.value,n=(r=document.getElementById("create-deck-orientation"))==null?void 0:r.value;p({type:"create-deck",name:a,size:d,orientation:n,data:null})}function C(e){var a,d,n,t;e?((a=document.getElementById("box-create-error"))==null||a.classList.remove("hidden"),(d=document.getElementById("box-create"))==null||d.classList.add("hidden")):((n=document.getElementById("box-create-error"))==null||n.classList.add("hidden"),(t=document.getElementById("box-create"))==null||t.classList.remove("hidden"))}function O(){var e,a;(e=document.getElementById("create-deck-frm"))==null||e.addEventListener("submit",S),(a=document.getElementById("box-create-error-close"))==null||a.addEventListener("click",()=>{C(!1)})}const u=document.getElementById("card-list");let m=[],s=[];function g(){p({type:"save-cards-data",data:JSON.stringify(s)})}function T(e,a,d,n){s[e-1][a]=n+"|"+d,g()}function k(e){e&&(s=JSON.parse(e),E())}function b(e,a){let d=document.createElement("div");d.classList.add("card-entry"),d.id="card-entry-"+e;let n=document.createElement("div");n.classList.add("card-actions");let t=document.createElement("div");t.classList.add("card-action-copy"),t.addEventListener("click",()=>{D(e)}),n.appendChild(t);let c=document.createElement("div");c.classList.add("card-action-delete"),c.addEventListener("click",()=>{x(e)}),n.appendChild(c);let r=document.createElement("div");r.classList.add("card-num"),r.innerText=String(e).padStart(2,"0"),d.appendChild(r);for(let l=0;l<m.length;l++)if(m[l].type=="text"){let i=document.createElement("div");i.classList.add("card-text");let o=document.createElement("input");a.hasOwnProperty(m[l].name)&&(o.value=a[m[l].name]),o.addEventListener("blur",()=>{R(e,m[l].name,o.value)}),i.appendChild(o),d.appendChild(i)}else{let i=document.createElement("div");i.classList.add("card-image");let o=document.createElement("img"),f=document.createElement("input");if(f.type="file",f.accept="image/*",i.appendChild(f),a.hasOwnProperty(m[l].name)){let y=a[m[l].name].split("|")[1];o.src=L+y}else o.src="images/add_image.png";i.appendChild(o),o.addEventListener("click",()=>{f.click()}),f.addEventListener("change",y=>{_(e,m[l].name,o,y)}),d.appendChild(i)}return d.appendChild(n),d}function w(){let e={};console.log(s),s.push(e);let a=b(s.length,e);u==null||u.appendChild(a),g(),u.scrollTop=u==null?void 0:u.scrollHeight}function x(e){s.splice(e-1,1),g(),E()}function D(e){let a=structuredClone(s[e-1]);s.splice(e-1,0,a),g(),E()}function R(e,a,d){s[e-1][a]=d,g()}async function _(e,a,d,n){var c;const t=n.target;if((c=t==null?void 0:t.files)!=null&&c.length){const r=t==null?void 0:t.files[0];if(r){const l=await r.arrayBuffer(),i=new Uint8Array(l),o=r.type,f=URL.createObjectURL(new Blob([i],{type:o}));d.src=f,p({type:"create-image-data",data:{data:i,mimeType:o,num:e,name:a}}),t.value=""}}}function P(){const e=document.getElementById("cards-header"),a=document.getElementById("cards-header-actions");console.log("cardHeader",e),console.log("cardsHeaderActions",a),document.querySelectorAll(".card-header").forEach(d=>d.remove());for(let d=0;d<m.length;d++){let n=m[d];console.log(n);let t=document.createElement("div");t.classList.add("card-header"),n.type=="image"?t.classList.add("card-image"):t.classList.add("card-text"),t.innerText=n.name.substring(1),e==null||e.insertBefore(t,a)}p({type:"load-cards-data",data:""})}function E(){document.querySelectorAll(".card-entry").forEach(e=>e.remove());for(let e=0;e<s.length;e++){let a=b(e+1,s[e]);u==null||u.appendChild(a)}}function M(){p({type:"forje-cards",data:{cardsData:s}})}function N(){var e,a;p({type:"load-card-fields",data:""}),(e=document.getElementById("add-card"))==null||e.addEventListener("click",()=>{w()}),(a=document.getElementById("forge-cards"))==null||a.addEventListener("click",()=>{M()})}window.onload=e=>{I(),A(),O(),N(),console.log("page is fully loaded")};
