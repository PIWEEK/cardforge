console.log("Hello from the plugin!");let o,l;penpot.ui.open("CardForge","",{width:1200,height:650});function s(){let e=penpot.currentPage.getPluginData("cardsData");console.log("loaded cards data:",e);let n=JSON.parse(e);penpot.ui.sendMessage({type:"CARDS_DATA",data:n})}function c(e){var n,t;return((n=e.name)==null?void 0:n.startsWith("#"))&&(e.type=="text"||e.type=="rect"&&((t=e.fills)==null?void 0:t.length)==1&&e.fills[0].fillImage)}function p(e,n){for(let t=0;t<e.children.length;t++){let a=e.children[t];if(c(a)){let i=a.type=="text"?"text":"image";n.push({name:a.name,type:i,id:a.id})}a.hasOwnProperty("children")&&p(a,n)}return n}function f(){const e=penpot.currentPage.getShapeById("00000000-0000-0000-0000-000000000000"),n=u(e,"Front"),t=p(n,[]);penpot.ui.sendMessage({type:"CARD_FIELDS",data:{fields:t,assetsUrl:"https://early.penpot.dev/assets/by-file-media-id/"}})}function u(e,n){for(let t=0;t<e.children.length;t++){let a=e.children[t];if(a.hasOwnProperty("name")&&a.name===n)return a}}function g(e){penpot.currentPage.name=e.name;const n=penpot.createFrame();n.name="_Images",n.y=-1e3,n.hidden=!0,o=penpot.createFrame(),o.name="Front";const t=penpot.createFrame();t.name="inside",t.borderRadius=10,t.strokes=[{strokeColor:"#000000",strokeStyle:"solid",strokeWidth:10,strokeAlignment:"inner"}],console.log(e),e.size=="P1"&&(e.orientation=="portrait"?(o.resize(238,333),t.resize(218,313)):(o.resize(333,238),t.resize(313,218)),t.x=10,t.y=10),o.appendChild(t),l=o.clone(),l.name="Back",l.x+=o.width+50}function h(e){penpot.currentPage.getShapeById("00000000-0000-0000-0000-000000000000").children.length==0?g(e):penpot.ui.sendMessage({type:"ERROR_DECK_CREATE_PAGE_NOT_EMPTY"})}function y(e,n,t,a){penpot.uploadMediaData("image",e,n).then(i=>{var d;const r=penpot.createRectangle();r.resize(i.width,i.height),r.fills=[{fillOpacity:1,fillImage:i}],r.x=0,r.y=0,penpot.currentPage.findShapes({name:"_Images"})[0].appendChild(r),penpot.ui.sendMessage({type:"IMAGE_CREATED",data:{num:t,name:a,id:(d=r.fills[0].fillImage)==null?void 0:d.id}})}).catch(i=>console.error(i))}penpot.ui.onMessage(e=>{if(console.log("message: ",e),e.type!=="duplicate"){if(e.type==="create-deck")h(e);else if(e.type==="save-cards-data")penpot.currentPage.setPluginData("cardsData",JSON.stringify(e.data));else if(e.type==="load-cards-data")s();else if(e.type==="load-card-fields")f();else if(e.type==="create-image-data"){const{data:n,mimeType:t,num:a,name:i}=e.data;y(n,t,a,i)}}});
